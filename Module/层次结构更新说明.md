# Excelæ•°æ®æŸ¥çœ‹å™¨ - å±‚æ¬¡ç»“æ„æ›´æ–°è¯´æ˜

## ğŸ“Š æ–°çš„å±‚æ¬¡ç»“æ„

### æ•´ä½“æ¶æ„

```
ExcelDataViewerWindow (self)
â”œâ”€ ä¸»é€‰é¡¹å¡ (self.tab_widget)
â”‚  â”œâ”€ "å®æ—¶æ•°æ®" é€‰é¡¹å¡
â”‚  â”‚  â””â”€ è®¾å¤‡é€‰é¡¹å¡ (self.device_tabs) â¬…ï¸ ç¬¬1å±‚
â”‚  â”‚     â”œâ”€ "device_001" é€‰é¡¹å¡
â”‚  â”‚     â”‚  â””â”€ æ•°æ®ç±»å‹é€‰é¡¹å¡ (device_tab.data_type_tabs) â¬…ï¸ ç¬¬2å±‚
â”‚  â”‚     â”‚     â”œâ”€ "åŠŸç‡W" é€‰é¡¹å¡
â”‚  â”‚     â”‚     â”‚  â””â”€ Sheeté€‰é¡¹å¡ (widget.sheet_tabs) â¬…ï¸ ç¬¬3å±‚
â”‚  â”‚     â”‚     â”‚     â”œâ”€ "Sheet A" é€‰é¡¹å¡ â†’ å›¾è¡¨
â”‚  â”‚     â”‚     â”‚     â”œâ”€ "Sheet B" é€‰é¡¹å¡ â†’ å›¾è¡¨
â”‚  â”‚     â”‚     â”‚     â””â”€ "Sheet C" é€‰é¡¹å¡ â†’ å›¾è¡¨
â”‚  â”‚     â”‚     â”œâ”€ "ç”µå‹" é€‰é¡¹å¡
â”‚  â”‚     â”‚     â”‚  â””â”€ Sheeté€‰é¡¹å¡
â”‚  â”‚     â”‚     â”‚     â”œâ”€ "Sheet A" â†’ å›¾è¡¨
â”‚  â”‚     â”‚     â”‚     â”œâ”€ "Sheet B" â†’ å›¾è¡¨
â”‚  â”‚     â”‚     â”‚     â””â”€ "Sheet C" â†’ å›¾è¡¨
â”‚  â”‚     â”‚     â”œâ”€ "ç”µæµ" é€‰é¡¹å¡
â”‚  â”‚     â”‚     â”‚  â””â”€ Sheeté€‰é¡¹å¡ (åŒä¸Š)
â”‚  â”‚     â”‚     â””â”€ "ç›¸è§’" é€‰é¡¹å¡
â”‚  â”‚     â”‚        â””â”€ Sheeté€‰é¡¹å¡ (åŒä¸Š)
â”‚  â”‚     â””â”€ "device_002" é€‰é¡¹å¡
â”‚  â”‚        â””â”€ æ•°æ®ç±»å‹é€‰é¡¹å¡ (åŒä¸Š)
â”‚  â””â”€ "å†å²æ•°æ®" é€‰é¡¹å¡
â”‚     â”œâ”€ å·¦ä¾§ï¼šå†å²è®°å½•åˆ—è¡¨ (self.history_list)
â”‚     â””â”€ å³ä¾§ï¼šå†å²è®¾å¤‡é€‰é¡¹å¡ (self.history_device_tabs)
â”‚        â””â”€ æ˜¾ç¤ºé€‰ä¸­å†å²è®°å½•çš„è®¾å¤‡æ•°æ®
â””â”€ çŠ¶æ€æ 
```

---

## ğŸ”„ ä¸‰å±‚åµŒå¥—é€‰é¡¹å¡

### ç¬¬1å±‚ï¼šè®¾å¤‡é€‰é¡¹å¡ (`self.device_tabs`)
- **ä½œç”¨åŸŸ**: `self` å±æ€§
- **åˆ›å»ºä½ç½®**: `create_realtime_tab()`
- **Tabå†…å®¹**: æ¯ä¸ªè®¾å¤‡ä¸€ä¸ªé€‰é¡¹å¡
- **Tabæ ‡é¢˜**: è®¾å¤‡IDï¼ˆå¦‚ "device_001"ï¼‰

### ç¬¬2å±‚ï¼šæ•°æ®ç±»å‹é€‰é¡¹å¡ (`device_tab.data_type_tabs`)
- **ä½œç”¨åŸŸ**: `device_tab` å¯¹è±¡å±æ€§
- **åˆ›å»ºä½ç½®**: `create_device_tab_content(device_id)`
- **Tabå†…å®¹**: 4ä¸ªæ•°æ®ç±»å‹
  - åŠŸç‡W
  - ç”µå‹
  - ç”µæµ
  - ç›¸è§’

### ç¬¬3å±‚ï¼šSheeté€‰é¡¹å¡ (`data_type_widget.sheet_tabs`)
- **ä½œç”¨åŸŸ**: `data_type_widget` å¯¹è±¡å±æ€§
- **åˆ›å»ºä½ç½®**: `create_data_type_content(data_type)`
- **Tabå†…å®¹**: 3ä¸ªSheet
  - Sheet A
  - Sheet B
  - Sheet C
- **æ¯ä¸ªSheetåŒ…å«**: å¯¹åº”çš„å›¾è¡¨ï¼ˆMatplotlib Figure + Canvasï¼‰

---

## ğŸ”§ æ ¸å¿ƒæ–¹æ³•

### 1. `create_device_tab_content(device_id: str) -> QWidget`

**åŠŸèƒ½**: ä¸ºè®¾å¤‡åˆ›å»ºé€‰é¡¹å¡å†…å®¹

**åˆ›å»ºå†…å®¹**:
```python
device_tab
â”œâ”€ info_group (è®¾å¤‡ä¿¡æ¯)
â”‚  â”œâ”€ device_tab.info_labels['file']      # è®¾å¤‡ID
â”‚  â”œâ”€ device_tab.info_labels['time']      # æ¥æ”¶æ—¶é—´
â”‚  â”œâ”€ device_tab.info_labels['voltage']   # é¢å®šç”µå‹
â”‚  â””â”€ device_tab.info_labels['frequency'] # é¢å®šé¢‘ç‡
â””â”€ device_tab.data_type_tabs (æ•°æ®ç±»å‹é€‰é¡¹å¡)
   â”œâ”€ "åŠŸç‡W" tab â†’ create_data_type_content("åŠŸç‡W")
   â”œâ”€ "ç”µå‹" tab â†’ create_data_type_content("ç”µå‹")
   â”œâ”€ "ç”µæµ" tab â†’ create_data_type_content("ç”µæµ")
   â””â”€ "ç›¸è§’" tab â†’ create_data_type_content("ç›¸è§’")
```

**è¿”å›**: `device_tab` (QWidgetå¯¹è±¡)

---

### 2. `create_data_type_content(data_type: str) -> QWidget`

**åŠŸèƒ½**: ä¸ºæ•°æ®ç±»å‹åˆ›å»ºé€‰é¡¹å¡å†…å®¹ï¼ˆåŒ…å«Sheet A/B/Cå­é€‰é¡¹å¡ï¼‰

**åˆ›å»ºå†…å®¹**:
```python
data_type_widget
â””â”€ data_type_widget.sheet_tabs (Sheeté€‰é¡¹å¡)
   â”œâ”€ "Sheet A" tab
   â”‚  â”œâ”€ Figure (å›¾è¡¨å¯¹è±¡)
   â”‚  â””â”€ Canvas (ç”»å¸ƒå¯¹è±¡)
   â”œâ”€ "Sheet B" tab
   â”‚  â”œâ”€ Figure
   â”‚  â””â”€ Canvas
   â””â”€ "Sheet C" tab
      â”œâ”€ Figure
      â””â”€ Canvas
```

**ä¿å­˜å¼•ç”¨**:
```python
widget.sheet_tabs = sheet_tabs
widget.chart_figures = {'Sheet A': fig_a, 'Sheet B': fig_b, 'Sheet C': fig_c}
widget.chart_canvases = {'Sheet A': canvas_a, 'Sheet B': canvas_b, 'Sheet C': canvas_c}
widget.data_type = data_type  # "åŠŸç‡W" / "ç”µå‹" / "ç”µæµ" / "ç›¸è§’"
```

**è¿”å›**: `data_type_widget` (QWidgetå¯¹è±¡)

---

### 3. `load_excel_file(file_path: str, device_id: str)`

**åŠŸèƒ½**: åŠ è½½Excelæ–‡ä»¶å¹¶æ˜¾ç¤º

**æ­¥éª¤**:
1. è¯»å–Excelæ–‡ä»¶çš„æ‰€æœ‰Sheetï¼ˆAã€Bã€Cï¼‰
2. è§£ææ¯ä¸ªSheetçš„æ•°æ® â†’ `xlsx_data` å¯¹è±¡
3. ä¿å­˜åˆ° `self.device_data[device_id] = {sheet_name: xlsx_data, ...}`
4. åˆ›å»ºæˆ–æ›´æ–°è®¾å¤‡é€‰é¡¹å¡
5. è°ƒç”¨ `draw_all_device_charts()` ç»˜åˆ¶æ‰€æœ‰å›¾è¡¨
6. ä¿å­˜åˆ°å†å²è®°å½•

**æ•°æ®ç»“æ„**:
```python
self.device_data = {
    'device_001': {
        'Sheet_A': xlsx_data_object,
        'Sheet_B': xlsx_data_object,
        'Sheet_C': xlsx_data_object
    },
    'device_002': {
        'Sheet_A': xlsx_data_object,
        'Sheet_B': xlsx_data_object,
        'Sheet_C': xlsx_data_object
    }
}
```

---

### 4. `draw_all_device_charts(device_tab, sheet_data_dict: dict)`

**åŠŸèƒ½**: ç»˜åˆ¶è®¾å¤‡çš„æ‰€æœ‰å›¾è¡¨

**æ­¥éª¤**:
1. éå†æ‰€æœ‰æ•°æ®ç±»å‹ï¼ˆåŠŸç‡Wã€ç”µå‹ã€ç”µæµã€ç›¸è§’ï¼‰
2. å¯¹äºæ¯ä¸ªæ•°æ®ç±»å‹ï¼Œéå†æ‰€æœ‰Sheetï¼ˆAã€Bã€Cï¼‰
3. æŸ¥æ‰¾å¯¹åº”çš„ `data_type_item` å’Œ `figure/canvas`
4. è°ƒç”¨ `draw_single_chart()` ç»˜åˆ¶å›¾è¡¨

**å‚æ•°**:
- `device_tab`: è®¾å¤‡é€‰é¡¹å¡å¯¹è±¡
- `sheet_data_dict`: `{sheet_name: xlsx_data}` å­—å…¸

**è®¿é—®å±‚æ¬¡**:
```python
# ç¬¬2å±‚ï¼šæ•°æ®ç±»å‹é€‰é¡¹å¡
data_type_widget = device_tab.data_type_tabs.widget(data_type_idx)
data_type_name = device_tab.data_type_tabs.tabText(data_type_idx)

# ç¬¬3å±‚ï¼šSheeté€‰é¡¹å¡
sheet_name = data_type_widget.sheet_tabs.tabText(sheet_idx)
figure = data_type_widget.chart_figures[sheet_name]
canvas = data_type_widget.chart_canvases[sheet_name]
```

---

## ğŸ“ å†å²æ•°æ®åŠŸèƒ½

### å·¦å³åˆ†å‰²å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å†å²æ•°æ®é€‰é¡¹å¡                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å†å²è®°å½•åˆ—è¡¨    â”‚  å†å²è®¾å¤‡é€‰é¡¹å¡                            â”‚
â”‚  (25%)          â”‚  (75%)                                    â”‚
â”‚                 â”‚                                            â”‚
â”‚  â— 2025-12-11   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    device_001   â”‚  â”‚ device_001 - data.xlsx               â”‚ â”‚
â”‚                 â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â—‹ 2025-12-10   â”‚  â”‚ è®¾å¤‡ä¿¡æ¯: ...                        â”‚ â”‚
â”‚    device_002   â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚                 â”‚  â”‚ æ•°æ®ç±»å‹é€‰é¡¹å¡                        â”‚ â”‚
â”‚  â—‹ 2025-12-09   â”‚  â”‚  â”œ åŠŸç‡W                            â”‚ â”‚
â”‚    device_001   â”‚  â”‚  â”œ ç”µå‹                              â”‚ â”‚
â”‚                 â”‚  â”‚  â”œ ç”µæµ                              â”‚ â”‚
â”‚                 â”‚  â”‚  â”” ç›¸è§’                              â”‚ â”‚
â”‚                 â”‚  â”‚                                       â”‚ â”‚
â”‚                 â”‚  â”‚    Sheeté€‰é¡¹å¡                        â”‚ â”‚
â”‚                 â”‚  â”‚      â”œ Sheet A                       â”‚ â”‚
â”‚                 â”‚  â”‚      â”œ Sheet B                       â”‚ â”‚
â”‚                 â”‚  â”‚      â”” Sheet C                       â”‚ â”‚
â”‚                 â”‚  â”‚                                       â”‚ â”‚
â”‚                 â”‚  â”‚    [å›¾è¡¨æ˜¾ç¤ºåŒºåŸŸ]                     â”‚ â”‚
â”‚                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ–¹æ³•

#### `load_history_data()`
- æ ¹æ®æ—¥æœŸèŒƒå›´å’Œè®¾å¤‡è¿‡æ»¤å†å²è®°å½•
- å¡«å……å·¦ä¾§å†å²è®°å½•åˆ—è¡¨
- æ¯ä¸ªåˆ—è¡¨é¡¹ä¿å­˜å®Œæ•´çš„è®°å½•æ•°æ®ï¼ˆåŒ…æ‹¬ `sheet_data_dict`ï¼‰

#### `on_history_item_clicked(item: QListWidgetItem)`
- ä»åˆ—è¡¨é¡¹è·å–å®Œæ•´è®°å½•
- åˆ›å»ºè®¾å¤‡é€‰é¡¹å¡æ˜¾ç¤ºå†å²æ•°æ®
- è°ƒç”¨ `draw_all_device_charts()` ç»˜åˆ¶å›¾è¡¨
- åœ¨å³ä¾§æ˜¾ç¤ºé€‰ä¸­çš„å†å²è®°å½•

---

## ğŸ¯ æ•°æ®æµ

### å®æ—¶æ•°æ®æ¥æ”¶

```
WebSocketé€šçŸ¥
    â†“
on_new_data_received()
    â†“
ä¸‹è½½æ–‡ä»¶ (ExcelDownloadThread)
    â†“
on_download_finished()
    â†“
load_excel_file(file_path, device_id)
    â†“
è¯»å–æ‰€æœ‰Sheet â†’ è§£ææ•°æ® â†’ ä¿å­˜åˆ° self.device_data
    â†“
åˆ›å»º/æ›´æ–°è®¾å¤‡é€‰é¡¹å¡
    â†“
draw_all_device_charts() â†’ ç»˜åˆ¶æ‰€æœ‰å›¾è¡¨
    â†“
save_to_history() â†’ ä¿å­˜åˆ°å†å²è®°å½•
```

### å†å²æ•°æ®æŸ¥çœ‹

```
ç‚¹å‡»"æŸ¥è¯¢"æŒ‰é’®
    â†“
load_history_data()
    â†“
è¿‡æ»¤å†å²è®°å½• â†’ å¡«å……åˆ—è¡¨
    â†“
ç‚¹å‡»åˆ—è¡¨é¡¹
    â†“
on_history_item_clicked()
    â†“
ä»è®°å½•è·å– sheet_data_dict
    â†“
åˆ›å»ºè®¾å¤‡é€‰é¡¹å¡ â†’ ç»˜åˆ¶å›¾è¡¨
    â†“
åœ¨å³ä¾§æ˜¾ç¤º
```

---

## ğŸ“¦ æ•°æ®ç»“æ„

### 1. `self.device_data`
```python
{
    'device_id': {
        'sheet_name': xlsx_data_object,
        ...
    }
}
```

### 2. `self.history_data`
```python
[
    {
        'file_path': 'data/excel/device_001/data.xlsx',
        'device_id': 'device_001',
        'timestamp': '2025-12-11 14:30:00',
        'file_name': 'data.xlsx',
        'sheet_data_dict': {
            'Sheet_A': xlsx_data_object,
            'Sheet_B': xlsx_data_object,
            'Sheet_C': xlsx_data_object
        }
    },
    ...
]
```

### 3. `xlsx_data` å¯¹è±¡
```python
class xlsx_data:
    rated_voltage: str          # é¢å®šç”µå‹
    rated_voltage_unit: str     # ç”µå‹å•ä½
    rated_frequency: str        # é¢å®šé¢‘ç‡
    rated_frequency_unit: str   # é¢‘ç‡å•ä½
    data: List[xlsx_datas_type_item]  # æ•°æ®ç±»å‹åˆ—è¡¨
    
class xlsx_datas_type_item:
    name: str                   # æ•°æ®ç±»å‹åç§° (åŠŸç‡W/ç”µå‹/ç”µæµ/ç›¸è§’)
    phases: List[xlsx_datas_phase_item]  # ç›¸ä½åˆ—è¡¨
    
class xlsx_datas_phase_item:
    name: str                   # ç›¸ä½åç§° (Aç›¸/Bç›¸/Cç›¸)
    devices: List[xlsx_datas_device_item]  # è®¾å¤‡åˆ—è¡¨
    
class xlsx_datas_device_item:
    device_name: str            # è®¾å¤‡åç§°
    x_axis: List[str]           # Xè½´æ ‡ç­¾
    x_axis_name: List[str]      # Xè½´åç§°
    y_data: List[float]         # Yè½´æ•°æ®
    y_unit: str                 # Yè½´å•ä½
```

---

## âœ… å…³é”®ç‰¹æ€§

### 1. **å¤šè®¾å¤‡æ”¯æŒ**
- ä¸åŒè®¾å¤‡IDçš„æ•°æ®åœ¨ç¬¬1å±‚ï¼ˆè®¾å¤‡é€‰é¡¹å¡ï¼‰åˆ†å¼€æ˜¾ç¤º
- è‡ªåŠ¨åˆ›å»ºæ–°è®¾å¤‡é€‰é¡¹å¡

### 2. **å¤šSheetæ”¯æŒ**
- æ¯ä¸ªExcelæ–‡ä»¶çš„Aã€Bã€Cä¸‰ä¸ªSheetåœ¨ç¬¬3å±‚åˆ†å¼€æ˜¾ç¤º
- æ¯ä¸ªSheetæœ‰ç‹¬ç«‹çš„å›¾è¡¨

### 3. **å››ç§æ•°æ®ç±»å‹**
- åŠŸç‡Wã€ç”µå‹ã€ç”µæµã€ç›¸è§’åœ¨ç¬¬2å±‚åˆ†å¼€æ˜¾ç¤º
- æ¯ç§æ•°æ®ç±»å‹æœ‰3ä¸ªSheetçš„å›¾è¡¨

### 4. **å†å²è®°å½•**
- ä¿å­˜æ‰€æœ‰æ¥æ”¶çš„æ•°æ®ï¼ˆåŒ…æ‹¬æ‰€æœ‰Sheetï¼‰
- æ”¯æŒæ—¥æœŸå’Œè®¾å¤‡è¿‡æ»¤
- ç‚¹å‡»æŸ¥çœ‹å®Œæ•´çš„å†å²æ•°æ®å’Œå›¾è¡¨

### 5. **åŠ¨æ€æ›´æ–°**
- æ–°æ•°æ®åˆ°è¾¾æ—¶è‡ªåŠ¨åˆ›å»ºæˆ–æ›´æ–°å¯¹åº”çš„é€‰é¡¹å¡
- è‡ªåŠ¨åˆ‡æ¢åˆ°æœ€æ–°çš„è®¾å¤‡é€‰é¡¹å¡

---

## ğŸ” è®¿é—®æ•°æ®ç¤ºä¾‹

### è®¿é—®ç¬¬1å±‚ï¼ˆè®¾å¤‡é€‰é¡¹å¡ï¼‰

```python
# æŸ¥æ‰¾è®¾å¤‡é€‰é¡¹å¡
tab_index = self.find_device_tab("device_001")
device_tab = self.device_tabs.widget(tab_index)

# æ›´æ–°è®¾å¤‡ä¿¡æ¯
device_tab.info_labels['file'].setText(f"è®¾å¤‡ID: {device_id}")
device_tab.info_labels['voltage'].setText(f"é¢å®šç”µå‹: {voltage}")
```

### è®¿é—®ç¬¬2å±‚ï¼ˆæ•°æ®ç±»å‹é€‰é¡¹å¡ï¼‰

```python
# éå†æ•°æ®ç±»å‹
for i in range(device_tab.data_type_tabs.count()):
    data_type_widget = device_tab.data_type_tabs.widget(i)
    data_type_name = device_tab.data_type_tabs.tabText(i)  # "åŠŸç‡W" / "ç”µå‹" ç­‰
```

### è®¿é—®ç¬¬3å±‚ï¼ˆSheeté€‰é¡¹å¡ï¼‰

```python
# éå†Sheet
for j in range(data_type_widget.sheet_tabs.count()):
    sheet_name = data_type_widget.sheet_tabs.tabText(j)  # "Sheet A" / "Sheet B" ç­‰
    
    # è·å–å›¾è¡¨å¯¹è±¡
    figure = data_type_widget.chart_figures[sheet_name]
    canvas = data_type_widget.chart_canvases[sheet_name]
    
    # ç»˜åˆ¶å›¾è¡¨
    figure.clear()
    ax = figure.add_subplot(111)
    # ... ç»˜åˆ¶é€»è¾‘
    canvas.draw()
```

---

## ğŸ“Š å®Œæ•´ç¤ºä¾‹

### ç»˜åˆ¶æ‰€æœ‰å›¾è¡¨

```python
def draw_all_device_charts(self, device_tab, sheet_data_dict):
    """ç»˜åˆ¶è®¾å¤‡çš„æ‰€æœ‰å›¾è¡¨"""
    
    # ç¬¬2å±‚ï¼šéå†æ•°æ®ç±»å‹
    for data_type_idx in range(device_tab.data_type_tabs.count()):
        data_type_widget = device_tab.data_type_tabs.widget(data_type_idx)
        data_type_name = device_tab.data_type_tabs.tabText(data_type_idx)
        
        # ç¬¬3å±‚ï¼šéå†Sheet
        for sheet_idx in range(data_type_widget.sheet_tabs.count()):
            sheet_name = data_type_widget.sheet_tabs.tabText(sheet_idx)
            
            # åŒ¹é…å®é™…çš„sheetåç§°
            actual_sheet_name = self.match_sheet_name(sheet_name, sheet_data_dict.keys())
            sheet_data = sheet_data_dict[actual_sheet_name]
            
            # æŸ¥æ‰¾å¯¹åº”çš„æ•°æ®ç±»å‹é¡¹
            data_type_item = self.find_data_type_item(sheet_data, data_type_name)
            
            # è·å–å›¾è¡¨å¯¹è±¡
            figure = data_type_widget.chart_figures[sheet_name]
            canvas = data_type_widget.chart_canvases[sheet_name]
            
            # ç»˜åˆ¶å›¾è¡¨
            self.draw_single_chart(data_type_item, figure, canvas, sheet_data)
```

---

## ğŸ‰ æ€»ç»“

### ä¿®æ”¹å†…å®¹

1. âœ… **ä¸‰å±‚åµŒå¥—é€‰é¡¹å¡**: è®¾å¤‡ â†’ æ•°æ®ç±»å‹ â†’ Sheet
2. âœ… **å¤šSheetæ”¯æŒ**: è‡ªåŠ¨è¯»å–å¹¶æ˜¾ç¤ºæ‰€æœ‰Sheetï¼ˆAã€Bã€Cï¼‰
3. âœ… **å®Œæ•´çš„å†å²è®°å½•**: ä¿å­˜æ‰€æœ‰Sheetæ•°æ®ï¼Œæ”¯æŒæŸ¥çœ‹å’Œè¿‡æ»¤
4. âœ… **å·¦å³åˆ†å‰²å¸ƒå±€**: å†å²è®°å½•åˆ—è¡¨ + æ•°æ®æ˜¾ç¤ºåŒºåŸŸ
5. âœ… **åŠ¨æ€å›¾è¡¨ç»˜åˆ¶**: è‡ªåŠ¨ä¸ºæ‰€æœ‰æ•°æ®ç±»å‹å’ŒSheetç»˜åˆ¶å›¾è¡¨

### å±‚æ¬¡ç»“æ„

```
ç¬¬0å±‚: ExcelDataViewerWindow (self)
  â”œâ”€ self.device_tabs               # ç¬¬1å±‚ï¼šè®¾å¤‡é€‰é¡¹å¡
  â”‚  â””â”€ device_tab
  â”‚     â””â”€ device_tab.data_type_tabs  # ç¬¬2å±‚ï¼šæ•°æ®ç±»å‹é€‰é¡¹å¡
  â”‚        â””â”€ data_type_widget
  â”‚           â””â”€ data_type_widget.sheet_tabs  # ç¬¬3å±‚ï¼šSheeté€‰é¡¹å¡
  â”‚              â””â”€ sheet_widget (Figure + Canvas)
  â””â”€ self.history_device_tabs       # å†å²æ•°æ®ï¼ˆç›¸åŒç»“æ„ï¼‰
```

æ‰€æœ‰åŠŸèƒ½å·²å®Œæ•´å®ç°ï¼Œæ²¡æœ‰linté”™è¯¯ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼ğŸ‰

