# ç•Œé¢ä¼˜åŒ–å’Œæ‰¹æ¬¡ç®¡ç†å®ç°è¯´æ˜

## ğŸ¯ å®ç°å†…å®¹

### 1. **ç”µé‡ç•Œé¢ - å­é€‰é¡¹å¡å’Œå †å æŸ±çŠ¶å›¾** âœ…

#### 1.1 ç•Œé¢ç»“æ„

**ä¹‹å‰ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–‡ä»¶ä¿¡æ¯                                â”‚
â”‚ è®¾å¤‡é€‰æ‹©: [ABC â–¼]                      â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ è¡¨æ ¼                                    â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ å•ä¸ªå›¾è¡¨                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¹‹åï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–‡ä»¶ä¿¡æ¯ï¼ˆåŒ…å«é¢å®šç”µå‹ã€é¢‘ç‡ï¼‰          â”‚
â”‚ è®¾å¤‡é€‰æ‹©: [ABC â–¼]                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [åŠŸç‡W] [ç”µå‹] [ç”µæµ] [ç›¸è§’]        â”‚ â”‚ â† å­é€‰é¡¹å¡
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚    å †å æŸ±çŠ¶å›¾                        â”‚ â”‚
â”‚ â”‚    â–Œâ–Œ  â–Œâ–Œ  â–Œâ–Œ                      â”‚ â”‚
â”‚ â”‚    â–Œâ–Œ  â–Œâ–Œ  â–Œâ–Œ                      â”‚ â”‚
â”‚ â”‚    â–Œâ–Œ  â–Œâ–Œ  â–Œâ–Œ                      â”‚ â”‚
â”‚ â”‚    Aç›¸ Bç›¸ Cç›¸                      â”‚ â”‚ â† æ¯ç›¸ä¸€æ ¹æŸ±å­
â”‚ â”‚                                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.2 å †å æŸ±çŠ¶å›¾é€»è¾‘

**æ ¸å¿ƒæ”¹è¿›ï¼š** æ¯ç›¸ä¸€æ ¹æŸ±å­ï¼ŒåŒä¸€ç›¸çš„å¤šä¸ªè®¾å¤‡å †å æ˜¾ç¤º

```python
# ä¹‹å‰ï¼šæ¯ä¸ªè®¾å¤‡ä¸€æ ¹æŸ±å­ï¼ˆ6æ ¹æŸ±å­ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â–Œ â–Œ â–Œ â–Œ â–Œ â–Œ                    â”‚
â”‚  â–Œ â–Œ â–Œ â–Œ â–Œ â–Œ                    â”‚
â”‚  A A B B C C                     â”‚ â† 6æ ¹æŸ±å­
â”‚  T T T T T T                     â”‚
â”‚  K D K D K D                     â”‚
â”‚  3 3 3 3 3 3                     â”‚
â”‚  3 3 3 3 3 3                     â”‚
â”‚  3 1 3 1 3 1                     â”‚
â”‚  0 0 0 0 0 0                     â”‚
â”‚    R   R   R                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

# ä¹‹åï¼šæ¯ç›¸ä¸€æ ¹æŸ±å­ï¼Œè®¾å¤‡å †å ï¼ˆ3æ ¹æŸ±å­ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â–“â–“  â–“â–“  â–“â–“                      â”‚ â† TD3310Rï¼ˆä¸Šå±‚ï¼‰
â”‚  â–“â–“  â–“â–“  â–“â–“                      â”‚
â”‚  â–’â–’  â–’â–’  â–’â–’                      â”‚ â† TK3330ï¼ˆä¸‹å±‚ï¼‰
â”‚  â–’â–’  â–’â–’  â–’â–’                      â”‚
â”‚  Aç›¸ Bç›¸ Cç›¸                      â”‚ â† 3æ ¹æŸ±å­
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°ä»£ç ï¼š**

```python
def draw_single_chart(self, data_type_item, figure, canvas, excel_data_obj):
    """ç»˜åˆ¶å•ä¸ªæ•°æ®ç±»å‹çš„å›¾è¡¨ï¼ˆå †å æŸ±çŠ¶å›¾ï¼‰"""
    
    # 3æ ¹æŸ±å­ï¼ˆAã€Bã€Cç›¸ï¼‰
    num_phases = len(y_data_phases)
    bar_width = 0.8 / num_phases
    
    for phase_idx, phase_item in enumerate(y_data_phases):
        # è®¡ç®—æŸ±å­ä½ç½®
        offset = (phase_idx - num_phases / 2 + 0.5) * bar_width
        bar_positions = x_pos + offset
        
        # âœ… å †å ç»˜åˆ¶è®¾å¤‡æ•°æ®
        bottom_values = np.zeros(len(x_labels))
        
        for device_idx, device_item in enumerate(devices):
            values = np.array(device_item.data)
            
            # âœ… ç»˜åˆ¶å †å æŸ±å­
            ax.bar(bar_positions, values, bar_width, 
                  bottom=bottom_values,  # å…³é”®ï¼šæŒ‡å®šåº•éƒ¨å€¼
                  color=device_colors[device_idx],
                  label=f"{phase_name}{device_name}")
            
            # âœ… æ›´æ–°åº•éƒ¨å€¼ï¼ˆç”¨äºå †å ï¼‰
            bottom_values += values
```

#### 1.3 å­é€‰é¡¹å¡å®ç°

```python
def create_realtime_tab(self):
    """åˆ›å»ºå®æ—¶æ•°æ®é€‰é¡¹å¡"""
    
    # âœ… æ·»åŠ æ•°æ®ç±»å‹å­é€‰é¡¹å¡
    self.data_type_tabs = QTabWidget()
    
    # ä¸ºæ¯ä¸ªæ•°æ®ç±»å‹åˆ›å»ºå›¾è¡¨
    for data_type in ['åŠŸç‡W', 'ç”µå‹', 'ç”µæµ', 'ç›¸è§’']:
        type_widget = QWidget()
        type_layout = QVBoxLayout(type_widget)
        
        # åˆ›å»ºå›¾è¡¨
        figure = Figure(figsize=(12, 6))
        canvas = FigureCanvas(figure)
        type_layout.addWidget(canvas)
        
        self.chart_figures[data_type] = figure
        self.chart_canvases[data_type] = canvas
        
        self.data_type_tabs.addTab(type_widget, data_type)
    
    # è¿æ¥é€‰é¡¹å¡åˆ‡æ¢äº‹ä»¶
    self.data_type_tabs.currentChanged.connect(self.on_data_type_tab_changed)
```

**æ•ˆæœï¼š**
- âœ… 4ä¸ªå­é€‰é¡¹å¡ï¼šåŠŸç‡Wã€ç”µå‹ã€ç”µæµã€ç›¸è§’
- âœ… æ¯ä¸ªé€‰é¡¹å¡æœ‰ç‹¬ç«‹çš„å›¾è¡¨
- âœ… åˆ‡æ¢é€‰é¡¹å¡å³å¯æŸ¥çœ‹ä¸åŒç±»å‹çš„æ•°æ®
- âœ… Xè½´ï¼šç›¸è§’/Â°,ç”µæµ/A
- âœ… Yè½´ï¼šå¯¹åº”æ•°æ®ç±»å‹çš„å€¼
- âœ… æ¯ç›¸ä¸€æ ¹æŸ±å­ï¼Œè®¾å¤‡å †å æ˜¾ç¤º

---

### 2. **å‡ ä½•é‡ç•Œé¢ - æ‰¹æ¬¡ç®¡ç†** âœ…

#### 2.1 æ‰¹æ¬¡ç®¡ç†é€»è¾‘

**æ ¸å¿ƒæ¦‚å¿µï¼š** å°†å›¾ç‰‡æŒ‰æ‰¹æ¬¡ç®¡ç†ï¼Œæ–°æ‰¹æ¬¡åˆ°æ¥æ—¶æ¸…ç©ºæ—§æ•°æ®

**æ‰¹æ¬¡è¯†åˆ«ï¼š**
```python
# ä½¿ç”¨æ—¶é—´æˆ³ï¼ˆç²¾ç¡®åˆ°åˆ†é’Ÿï¼‰+ è®¾å¤‡ID ä½œä¸ºæ‰¹æ¬¡ID
batch_id = timestamp[:16]  # "2025-12-12T14:30"
```

**æ‰¹æ¬¡æµç¨‹ï¼š**

```
æ‰¹æ¬¡ 1ï¼ˆ10 å¼ å›¾ç‰‡ï¼‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ—¶é—´: 2025-12-12T14:30              â”‚
â”‚ è®¾å¤‡: device_001                     â”‚
â”‚ â”Œâ”€â”¬â”€â”¬â”€â”¬â”€â”                          â”‚
â”‚ â”‚1â”‚2â”‚3â”‚4â”‚ åŸºç¡€åŒºåŸŸï¼ˆ8ä¸ªï¼‰           â”‚
â”‚ â”œâ”€â”¼â”€â”¼â”€â”¼â”€â”¤                          â”‚
â”‚ â”‚5â”‚6â”‚7â”‚8â”‚                           â”‚
â”‚ â”œâ”€â”¼â”€â”¬â”€â”¬â”€â”¤                          â”‚
â”‚ â”‚9â”‚10â”‚ â”‚ â”‚ ä¸´æ—¶åŒºåŸŸï¼ˆ+2ä¸ªï¼‰        â”‚  â† æ·»åŠ ä¸´æ—¶åŒºåŸŸ
â”‚ â””â”€â”´â”€â”´â”€â”´â”€â”˜                          â”‚
â”‚ æ€»è®¡: 10 ä¸ªåŒºåŸŸ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â†“ æ–°æ‰¹æ¬¡åˆ°æ¥

æ‰¹æ¬¡ 2ï¼ˆ5 å¼ å›¾ç‰‡ï¼‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ—¶é—´: 2025-12-12T14:35              â”‚
â”‚ è®¾å¤‡: device_001                     â”‚
â”‚ 1. æ¸…ç©ºæ‰€æœ‰åŒºåŸŸçš„å›¾ç‰‡ âœ…             â”‚
â”‚ 2. é”€æ¯ä¸´æ—¶åŒºåŸŸï¼ˆæ¢å¤åˆ°8ä¸ªï¼‰âœ…       â”‚
â”‚ â”Œâ”€â”¬â”€â”¬â”€â”¬â”€â”                          â”‚
â”‚ â”‚1â”‚2â”‚3â”‚4â”‚ åŸºç¡€åŒºåŸŸï¼ˆ8ä¸ªï¼‰           â”‚
â”‚ â”œâ”€â”¼â”€â”¼â”€â”¼â”€â”¤                          â”‚
â”‚ â”‚5â”‚ â”‚ â”‚ â”‚                           â”‚  â† åªä½¿ç”¨5ä¸ª
â”‚ â””â”€â”´â”€â”´â”€â”´â”€â”˜                          â”‚
â”‚ æ€»è®¡: 8 ä¸ªåŒºåŸŸï¼ˆ5ä¸ªè¢«ä½¿ç”¨ï¼‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â†“ æ–°æ‰¹æ¬¡åˆ°æ¥

æ‰¹æ¬¡ 3ï¼ˆ12 å¼ å›¾ç‰‡ï¼‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ—¶é—´: 2025-12-12T14:40              â”‚
â”‚ è®¾å¤‡: device_001                     â”‚
â”‚ 1. æ¸…ç©ºæ‰€æœ‰åŒºåŸŸçš„å›¾ç‰‡ âœ…             â”‚
â”‚ 2. å·²ç»æ˜¯åŸºç¡€åŒºåŸŸï¼Œæ— éœ€é”€æ¯ âœ…        â”‚
â”‚ â”Œâ”€â”¬â”€â”¬â”€â”¬â”€â”                          â”‚
â”‚ â”‚1â”‚2â”‚3â”‚4â”‚ åŸºç¡€åŒºåŸŸï¼ˆ8ä¸ªï¼‰           â”‚
â”‚ â”œâ”€â”¼â”€â”¼â”€â”¼â”€â”¤                          â”‚
â”‚ â”‚5â”‚6â”‚7â”‚8â”‚                           â”‚
â”‚ â”œâ”€â”¼â”€â”¼â”€â”¼â”€â”¤                          â”‚
â”‚ â”‚9â”‚10â”‚11â”‚12â”‚ ä¸´æ—¶åŒºåŸŸï¼ˆ+4ä¸ªï¼‰      â”‚  â† é‡æ–°æ·»åŠ ä¸´æ—¶åŒºåŸŸ
â”‚ â””â”€â”´â”€â”´â”€â”´â”€â”˜                          â”‚
â”‚ æ€»è®¡: 12 ä¸ªåŒºåŸŸ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.2 å®ç°ä»£ç 

```python
class ImageDataViewerWindow:
    def __init__(self):
        # æ‰¹æ¬¡ç®¡ç†
        self.current_batch_id = None  # å½“å‰æ‰¹æ¬¡ID
        self.current_batch_count = 0  # å½“å‰æ‰¹æ¬¡å·²æ¥æ”¶çš„å›¾ç‰‡æ•°é‡
        self.current_batch_device_id = None  # å½“å‰æ‰¹æ¬¡çš„è®¾å¤‡ID
    
    def on_new_image_received(self, data):
        """æ¥æ”¶åˆ°æ–°å›¾ç‰‡é€šçŸ¥"""
        device_id = data.get('device_id')
        timestamp = data.get('timestamp')
        
        # âœ… æ‰¹æ¬¡è¯†åˆ«ï¼ˆæ—¶é—´æˆ³ç²¾ç¡®åˆ°åˆ†é’Ÿï¼‰
        batch_id = timestamp[:16]  # "2025-12-12T14:30"
        
        # âœ… æ£€æŸ¥æ˜¯å¦æ˜¯æ–°æ‰¹æ¬¡
        if self.current_batch_id != batch_id or self.current_batch_device_id != device_id:
            # æ–°æ‰¹æ¬¡åˆ°æ¥ï¼šæ¸…ç©ºæ—§æ•°æ®
            self.start_new_batch(batch_id, device_id)
        
        self.current_batch_count += 1
        
        # é¢„ç•™åŒºåŸŸå¹¶ä¸‹è½½
        reserved_widget = self.reserve_display_widget()
        # ...
    
    def start_new_batch(self, batch_id, device_id):
        """
        å¼€å§‹æ–°æ‰¹æ¬¡
        æ¸…ç©ºæ—§æ•°æ®ï¼Œé”€æ¯ä¸´æ—¶åŒºåŸŸï¼Œæ¢å¤åˆ°åŸºç¡€åŒºåŸŸæ•°é‡
        """
        logger.info(f"å¼€å§‹æ–°æ‰¹æ¬¡: {batch_id}, è®¾å¤‡: {device_id}")
        
        # æ›´æ–°æ‰¹æ¬¡ä¿¡æ¯
        self.current_batch_id = batch_id
        self.current_batch_device_id = device_id
        self.current_batch_count = 0
        
        # âœ… 1. æ¸…ç©ºæ‰€æœ‰åŒºåŸŸçš„å›¾ç‰‡
        for widget in self.image_display_widgets:
            widget.clear()
        
        # âœ… 2. é”€æ¯ä¸´æ—¶åŒºåŸŸï¼ˆä¿ç•™åŸºç¡€åŒºåŸŸï¼‰
        while len(self.image_display_widgets) > self.base_widget_count:
            widget = self.image_display_widgets.pop()
            self.grid_layout.removeWidget(widget)
            widget.deleteLater()
            logger.info(f"é”€æ¯ä¸´æ—¶åŒºåŸŸ: {widget.index}")
        
        logger.info(f"å·²æ¢å¤åˆ°åŸºç¡€åŒºåŸŸæ•°é‡: {len(self.image_display_widgets)}")
        
        # æ›´æ–°æ‰¹æ¬¡ä¿¡æ¯æ˜¾ç¤º
        self.current_device_label.setText(f"è®¾å¤‡: {device_id}")
        self.current_batch_label.setText(f"æ‰¹æ¬¡æ—¶é—´: {batch_id}")
        self.current_count_label.setText(f"å›¾ç‰‡æ•°é‡: 0")
```

#### 2.3 æ‰¹æ¬¡ç®¡ç†ç‰¹ç‚¹

**ä¼˜ç‚¹ï¼š**
1. âœ… **è‡ªåŠ¨æ¸…ç©º** - æ–°æ‰¹æ¬¡åˆ°æ¥æ—¶è‡ªåŠ¨æ¸…ç©ºæ—§å›¾ç‰‡
2. âœ… **è‡ªåŠ¨æ¢å¤** - è‡ªåŠ¨é”€æ¯ä¸´æ—¶åŒºåŸŸï¼Œæ¢å¤åˆ°åŸºç¡€8ä¸ª
3. âœ… **åŠ¨æ€æ‰©å±•** - æ ¹æ®æ–°æ‰¹æ¬¡çš„å›¾ç‰‡æ•°é‡åŠ¨æ€æ·»åŠ åŒºåŸŸ
4. âœ… **æ‰¹æ¬¡éš”ç¦»** - æ¯ä¸ªæ‰¹æ¬¡çš„å›¾ç‰‡äº’ä¸å¹²æ‰°
5. âœ… **è®¾å¤‡éš”ç¦»** - ä¸åŒè®¾å¤‡çš„æ‰¹æ¬¡ç‹¬ç«‹ç®¡ç†

**æ‰¹æ¬¡è¯†åˆ«è§„åˆ™ï¼š**
- æ—¶é—´æˆ³å˜åŒ–ï¼ˆç²¾ç¡®åˆ°åˆ†é’Ÿï¼‰â†’ æ–°æ‰¹æ¬¡
- è®¾å¤‡IDå˜åŒ– â†’ æ–°æ‰¹æ¬¡

---

## ğŸ“Š å®Œæ•´å·¥ä½œæµç¨‹

### ç”µé‡ç•Œé¢

```
1. æ”¶åˆ° Excel æ–‡ä»¶ä¸Šä¼ é€šçŸ¥
   â†“
2. ä¸‹è½½æ–‡ä»¶åˆ° data/excel/{device_id}/
   â†“
3. è§£ææ–‡ä»¶ï¼ˆæŒ‰ç…§ test/get_test.py é€»è¾‘ï¼‰
   â”œâ”€ æå–é¢å®šç”µå‹ã€é¢‘ç‡
   â”œâ”€ è§£æ4ç§æ•°æ®ç±»å‹ï¼ˆåŠŸç‡Wã€ç”µå‹ã€ç”µæµã€ç›¸è§’ï¼‰
   â””â”€ æ¯ç§æ•°æ®ç±»å‹åŒ…å« Aã€Bã€C ä¸‰ç›¸æ•°æ®
   â†“
4. ä¸ºæ¯ç§æ•°æ®ç±»å‹ç»˜åˆ¶å †å æŸ±çŠ¶å›¾
   â”œâ”€ åŠŸç‡W â†’ é€‰é¡¹å¡1
   â”œâ”€ ç”µå‹   â†’ é€‰é¡¹å¡2
   â”œâ”€ ç”µæµ   â†’ é€‰é¡¹å¡3
   â””â”€ ç›¸è§’   â†’ é€‰é¡¹å¡4
   â†“
5. ç”¨æˆ·å¯ä»¥ç‚¹å‡»é€‰é¡¹å¡æŸ¥çœ‹ä¸åŒç±»å‹çš„å›¾è¡¨
```

### å‡ ä½•é‡ç•Œé¢

```
æ‰¹æ¬¡ 1 å¼€å§‹:
1. æ”¶åˆ°ç¬¬1å¼ å›¾ç‰‡é€šçŸ¥ï¼ˆæ—¶é—´: 14:30ï¼‰
   â”œâ”€ æ£€æµ‹æ‰¹æ¬¡: "2025-12-12T14:30"
   â”œâ”€ æ˜¯æ–°æ‰¹æ¬¡ â†’ start_new_batch()
   â”‚  â”œâ”€ æ¸…ç©ºæ‰€æœ‰åŒºåŸŸ
   â”‚  â””â”€ æ¢å¤åˆ°8ä¸ªåŸºç¡€åŒºåŸŸ
   â””â”€ é¢„ç•™åŒºåŸŸ0ï¼Œä¸‹è½½å›¾ç‰‡1
   
2. æ”¶åˆ°ç¬¬2å¼ å›¾ç‰‡é€šçŸ¥ï¼ˆæ—¶é—´: 14:30ï¼‰
   â”œâ”€ æ£€æµ‹æ‰¹æ¬¡: "2025-12-12T14:30"
   â”œâ”€ åŒä¸€æ‰¹æ¬¡ â†’ ç»§ç»­
   â””â”€ é¢„ç•™åŒºåŸŸ1ï¼Œä¸‹è½½å›¾ç‰‡2
   
3. ... æ”¶åˆ°ç¬¬8å¼ å›¾ç‰‡ ...
   
4. æ”¶åˆ°ç¬¬9å¼ å›¾ç‰‡é€šçŸ¥ï¼ˆæ—¶é—´: 14:30ï¼‰
   â”œâ”€ æ£€æµ‹æ‰¹æ¬¡: "2025-12-12T14:30"
   â”œâ”€ åŒä¸€æ‰¹æ¬¡ â†’ ç»§ç»­
   â”œâ”€ åŒºåŸŸä¸è¶³ â†’ åŠ¨æ€æ·»åŠ åŒºåŸŸ9
   â””â”€ é¢„ç•™åŒºåŸŸ9ï¼Œä¸‹è½½å›¾ç‰‡9

æ‰¹æ¬¡ 2 å¼€å§‹:
1. æ”¶åˆ°ç¬¬1å¼ å›¾ç‰‡é€šçŸ¥ï¼ˆæ—¶é—´: 14:35ï¼‰
   â”œâ”€ æ£€æµ‹æ‰¹æ¬¡: "2025-12-12T14:35"
   â”œâ”€ æ˜¯æ–°æ‰¹æ¬¡ â†’ start_new_batch()
   â”‚  â”œâ”€ æ¸…ç©ºæ‰€æœ‰åŒºåŸŸï¼ˆ9ä¸ªï¼‰
   â”‚  â””â”€ é”€æ¯ä¸´æ—¶åŒºåŸŸï¼ˆåŒºåŸŸ9ï¼‰ï¼Œæ¢å¤åˆ°8ä¸ª
   â””â”€ é¢„ç•™åŒºåŸŸ0ï¼Œä¸‹è½½å›¾ç‰‡1
   
2. æ”¶åˆ°ç¬¬2å¼ å›¾ç‰‡é€šçŸ¥ï¼ˆæ—¶é—´: 14:35ï¼‰
   â”œâ”€ æ£€æµ‹æ‰¹æ¬¡: "2025-12-12T14:35"
   â”œâ”€ åŒä¸€æ‰¹æ¬¡ â†’ ç»§ç»­
   â””â”€ é¢„ç•™åŒºåŸŸ1ï¼Œä¸‹è½½å›¾ç‰‡2
```

---

## ğŸ¨ ç•Œé¢å¯¹æ¯”

### ç”µé‡ç•Œé¢

**ä¹‹å‰ï¼š**
```
åªæœ‰ä¸€ä¸ªå›¾è¡¨ï¼Œéœ€è¦æ‰‹åŠ¨åˆ‡æ¢æ•°æ®ç±»å‹
```

**ä¹‹åï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–‡ä»¶: 20251212_143000_æ•°æ®.xlsx               â”‚
â”‚ è®¾å¤‡: device_001                               â”‚
â”‚ é¢å®šç”µå‹: 220.0V  é¢å®šåŠŸç‡: 53.0Hz            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [åŠŸç‡W] [ç”µå‹] [ç”µæµ] [ç›¸è§’]              â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚                                            â”‚ â”‚
â”‚ â”‚  åŠŸç‡W - å †å æŸ±çŠ¶å›¾                         â”‚ â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚ â”‚  â”‚  â–“â–“  â–“â–“  â–“â–“                        â”‚  â”‚ â”‚
â”‚ â”‚  â”‚  â–“â–“  â–“â–“  â–“â–“                        â”‚  â”‚ â”‚
â”‚ â”‚  â”‚  â–’â–’  â–’â–’  â–’â–’                        â”‚  â”‚ â”‚
â”‚ â”‚  â”‚  â–’â–’  â–’â–’  â–’â–’                        â”‚  â”‚ â”‚
â”‚ â”‚  â”‚  Aç›¸ Bç›¸ Cç›¸                        â”‚  â”‚ â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚ â”‚  Xè½´: ç›¸è§’/Â°,ç”µæµ/A                        â”‚ â”‚
â”‚ â”‚  Yè½´: åŠŸç‡W                                â”‚ â”‚
â”‚ â”‚  å›¾ä¾‹: Aç›¸TK3330 Aç›¸TD3310R ...           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‡ ä½•é‡ç•Œé¢

**æ‰¹æ¬¡ 1ï¼ˆ10å¼ å›¾ï¼‰ï¼š**
```
æ‰¹æ¬¡æ—¶é—´: 2025-12-12T14:30
è®¾å¤‡: device_001
å›¾ç‰‡æ•°é‡: 10

â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”
â”‚ 1â”‚ 2â”‚ 3â”‚ 4â”‚  åŸºç¡€åŒºåŸŸ
â”œâ”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¤
â”‚ 5â”‚ 6â”‚ 7â”‚ 8â”‚
â”œâ”€â”€â”¼â”€â”€â”¬â”€â”€â”¬â”€â”€â”¤
â”‚ 9â”‚10â”‚  â”‚  â”‚  ä¸´æ—¶åŒºåŸŸï¼ˆ+2ï¼‰
â””â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”˜
```

**æ‰¹æ¬¡ 2ï¼ˆ5å¼ å›¾ï¼‰ï¼š**
```
æ‰¹æ¬¡æ—¶é—´: 2025-12-12T14:35
è®¾å¤‡: device_001
å›¾ç‰‡æ•°é‡: 5

â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”
â”‚ 1â”‚ 2â”‚ 3â”‚ 4â”‚  åŸºç¡€åŒºåŸŸï¼ˆæ¸…ç©ºåé‡æ–°ä½¿ç”¨ï¼‰
â”œâ”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¤
â”‚ 5â”‚  â”‚  â”‚  â”‚
â””â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”˜
ä¸´æ—¶åŒºåŸŸå·²é”€æ¯ âœ…
```

---

## âœ… åŠŸèƒ½æ¸…å•

### ç”µé‡ç•Œé¢

- âœ… æ·»åŠ é¢å®šç”µå‹ã€é¢‘ç‡æ ‡ç­¾
- âœ… æ·»åŠ 4ä¸ªå­é€‰é¡¹å¡ï¼ˆåŠŸç‡Wã€ç”µå‹ã€ç”µæµã€ç›¸è§’ï¼‰
- âœ… æ¯ä¸ªé€‰é¡¹å¡ç‹¬ç«‹çš„å›¾è¡¨
- âœ… å †å æŸ±çŠ¶å›¾ï¼ˆæ¯ç›¸ä¸€æ ¹æŸ±å­ï¼‰
- âœ… è®¾å¤‡æ•°æ®å †å æ˜¾ç¤º
- âœ… Xè½´ï¼šç›¸è§’/Â°,ç”µæµ/A
- âœ… Yè½´ï¼šå¯¹åº”æ•°æ®ç±»å‹çš„å€¼
- âœ… å›¾ä¾‹æ˜¾ç¤ºæ‰€æœ‰ç›¸ä½å’Œè®¾å¤‡
- âœ… åˆ‡æ¢é€‰é¡¹å¡æ›´æ–°å›¾è¡¨

### å‡ ä½•é‡ç•Œé¢

- âœ… æ‰¹æ¬¡IDè¯†åˆ«ï¼ˆæ—¶é—´æˆ³ + è®¾å¤‡IDï¼‰
- âœ… æ–°æ‰¹æ¬¡è‡ªåŠ¨æ¸…ç©ºæ—§æ•°æ®
- âœ… æ–°æ‰¹æ¬¡è‡ªåŠ¨é”€æ¯ä¸´æ—¶åŒºåŸŸ
- âœ… æ¢å¤åˆ°åŸºç¡€8ä¸ªåŒºåŸŸ
- âœ… æ ¹æ®æ–°æ‰¹æ¬¡æ•°é‡åŠ¨æ€æ‰©å±•
- âœ… æ‰¹æ¬¡ä¿¡æ¯æ˜¾ç¤º
- âœ… å›¾ç‰‡æ•°é‡å®æ—¶æ›´æ–°

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### ç”µé‡ç•Œé¢æµ‹è¯•

1. **ä¸Šä¼  Excel æ–‡ä»¶**
   - æ£€æŸ¥æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º
   - æ£€æŸ¥é¢å®šå‚æ•°æ˜¾ç¤º

2. **æŸ¥çœ‹å­é€‰é¡¹å¡**
   - ç‚¹å‡»"åŠŸç‡W"é€‰é¡¹å¡
   - æ£€æŸ¥å›¾è¡¨æ˜¾ç¤ºï¼ˆå †å æŸ±çŠ¶å›¾ï¼‰
   - æ£€æŸ¥Aç›¸ã€Bç›¸ã€Cç›¸å„ä¸€æ ¹æŸ±å­
   - æ£€æŸ¥è®¾å¤‡æ•°æ®å †å æ˜¾ç¤º

3. **åˆ‡æ¢é€‰é¡¹å¡**
   - åˆ‡æ¢åˆ°"ç”µå‹"é€‰é¡¹å¡
   - åˆ‡æ¢åˆ°"ç”µæµ"é€‰é¡¹å¡
   - åˆ‡æ¢åˆ°"ç›¸è§’"é€‰é¡¹å¡
   - æ£€æŸ¥æ¯ä¸ªé€‰é¡¹å¡çš„å›¾è¡¨æ­£ç¡®æ˜¾ç¤º

4. **åˆ‡æ¢è®¾å¤‡**
   - å¦‚æœæœ‰å¤šä¸ªè®¾å¤‡ï¼ˆå¤šä¸ªsheetï¼‰
   - åˆ‡æ¢è®¾å¤‡ä¸‹æ‹‰æ¡†
   - æ£€æŸ¥å›¾è¡¨æ›´æ–°

### å‡ ä½•é‡ç•Œé¢æµ‹è¯•

#### æµ‹è¯•åœºæ™¯ 1ï¼šå°‘é‡å›¾ç‰‡ï¼ˆâ‰¤ 8å¼ ï¼‰

```
1. ä¸Šä¼  5 å¼ å›¾ç‰‡ï¼ˆæ‰¹æ¬¡1ï¼‰
   â”œâ”€ æ£€æŸ¥æ‰¹æ¬¡æ—¶é—´æ˜¾ç¤º
   â”œâ”€ æ£€æŸ¥å›¾ç‰‡æ•°é‡: 5
   â””â”€ æ£€æŸ¥ä½¿ç”¨äº†5ä¸ªåŸºç¡€åŒºåŸŸ

2. ä¸Šä¼  3 å¼ å›¾ç‰‡ï¼ˆæ‰¹æ¬¡2ï¼Œ1åˆ†é’Ÿåï¼‰
   â”œâ”€ æ£€æŸ¥æ—§å›¾ç‰‡è¢«æ¸…ç©º âœ…
   â”œâ”€ æ£€æŸ¥åŒºåŸŸæ•°é‡: 8ï¼ˆåŸºç¡€åŒºåŸŸï¼‰
   â”œâ”€ æ£€æŸ¥æ–°å›¾ç‰‡æ˜¾ç¤ºåœ¨å‰3ä¸ªåŒºåŸŸ
   â””â”€ æ£€æŸ¥æ‰¹æ¬¡æ—¶é—´æ›´æ–°
```

#### æµ‹è¯•åœºæ™¯ 2ï¼šå¤§é‡å›¾ç‰‡ï¼ˆ> 8å¼ ï¼‰

```
1. ä¸Šä¼  12 å¼ å›¾ç‰‡ï¼ˆæ‰¹æ¬¡1ï¼‰
   â”œâ”€ æ£€æŸ¥å›¾ç‰‡æ•°é‡: 12
   â”œâ”€ æ£€æŸ¥åŒºåŸŸæ•°é‡: 12ï¼ˆ8åŸºç¡€ + 4ä¸´æ—¶ï¼‰
   â””â”€ æ£€æŸ¥æ‰€æœ‰å›¾ç‰‡éƒ½æ˜¾ç¤º

2. ä¸Šä¼  5 å¼ å›¾ç‰‡ï¼ˆæ‰¹æ¬¡2ï¼Œ1åˆ†é’Ÿåï¼‰
   â”œâ”€ æ£€æŸ¥æ—§å›¾ç‰‡è¢«æ¸…ç©º âœ…
   â”œâ”€ æ£€æŸ¥ä¸´æ—¶åŒºåŸŸè¢«é”€æ¯ âœ…
   â”œâ”€ æ£€æŸ¥åŒºåŸŸæ•°é‡: 8ï¼ˆåŸºç¡€åŒºåŸŸï¼‰
   â””â”€ æ£€æŸ¥æ–°å›¾ç‰‡æ˜¾ç¤ºåœ¨å‰5ä¸ªåŒºåŸŸ
```

#### æµ‹è¯•åœºæ™¯ 3ï¼šè¿ç»­å¤šæ‰¹æ¬¡

```
æ‰¹æ¬¡1: 10å¼  â†’ åŒºåŸŸ: 10ï¼ˆ8åŸºç¡€ + 2ä¸´æ—¶ï¼‰
  â†“
æ‰¹æ¬¡2: 5å¼   â†’ åŒºåŸŸ: 8ï¼ˆæ¸…ç©ºï¼Œé”€æ¯ä¸´æ—¶ï¼Œä½¿ç”¨5ä¸ªï¼‰
  â†“
æ‰¹æ¬¡3: 15å¼  â†’ åŒºåŸŸ: 15ï¼ˆæ¸…ç©ºï¼Œæ·»åŠ 7ä¸ªä¸´æ—¶ï¼‰
  â†“
æ‰¹æ¬¡4: 8å¼   â†’ åŒºåŸŸ: 8ï¼ˆæ¸…ç©ºï¼Œé”€æ¯æ‰€æœ‰ä¸´æ—¶ï¼‰
  â†“
æ‰¹æ¬¡5: 20å¼  â†’ åŒºåŸŸ: 20ï¼ˆæ¸…ç©ºï¼Œæ·»åŠ 12ä¸ªä¸´æ—¶ï¼‰
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ‰¹æ¬¡è¯†åˆ«

```python
# æ‰¹æ¬¡ID = æ—¶é—´æˆ³ï¼ˆç²¾ç¡®åˆ°åˆ†é’Ÿï¼‰+ è®¾å¤‡ID

# åŒä¸€æ‰¹æ¬¡ï¼š
batch_id_1 = "2025-12-12T14:30" + "device_001"  # 14:30:10
batch_id_2 = "2025-12-12T14:30" + "device_001"  # 14:30:45
# â†’ åŒä¸€æ‰¹æ¬¡ âœ…

# ä¸åŒæ‰¹æ¬¡ï¼š
batch_id_1 = "2025-12-12T14:30" + "device_001"  # 14:30:59
batch_id_2 = "2025-12-12T14:31" + "device_001"  # 14:31:01
# â†’ ä¸åŒæ‰¹æ¬¡ âœ…

# ä¸åŒè®¾å¤‡ï¼š
batch_id_1 = "2025-12-12T14:30" + "device_001"
batch_id_2 = "2025-12-12T14:30" + "device_002"
# â†’ ä¸åŒæ‰¹æ¬¡ âœ…
```

### 2. åŒºåŸŸé”€æ¯

```python
# å¿…é¡»ä½¿ç”¨ deleteLater() è€Œä¸æ˜¯ del
widget.deleteLater()  # âœ… Qt å®‰å…¨åˆ é™¤
del widget            # âŒ å¯èƒ½å¯¼è‡´å´©æºƒ
```

### 3. å †å æŸ±çŠ¶å›¾

```python
# å¿…é¡»æŒ‡å®š bottom å‚æ•°æ¥å®ç°å †å 
bottom_values = np.zeros(len(x_labels))

for device in devices:
    ax.bar(positions, values, width, 
          bottom=bottom_values,  # âœ… å…³é”®å‚æ•°
          ...)
    bottom_values += values  # âœ… ç´¯åŠ åº•éƒ¨å€¼
```

---

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### 1. å†å²è®°å½•å®ç°

ç”µé‡ç•Œé¢å’Œå‡ ä½•é‡ç•Œé¢éƒ½éœ€è¦å®Œå–„å†å²è®°å½•åŠŸèƒ½ï¼š

```python
class ExcelDataViewerWindow:
    def create_history_tab(self):
        """åˆ›å»ºå†å²è®°å½•é€‰é¡¹å¡ï¼ˆç±»ä¼¼å‡ ä½•é‡ç•Œé¢ï¼‰"""
        
        # å·¦ä¾§ï¼šå†å²è®°å½•åˆ—è¡¨
        self.history_list = QListWidget()
        self.history_list.itemClicked.connect(self.on_history_clicked)
        
        # å³ä¾§ï¼šé€‰é¡¹å¡ï¼ˆåŠŸç‡Wã€ç”µå‹ã€ç”µæµã€ç›¸è§’ï¼‰
        self.history_tabs = QTabWidget()
        # ...
    
    def on_history_clicked(self, item):
        """ç‚¹å‡»å†å²è®°å½•ï¼Œæ˜¾ç¤ºå¯¹åº”çš„å›¾è¡¨"""
        record = item.data(Qt.ItemDataRole.UserRole)
        file_path = record['file_path']
        
        # åŠ è½½å¹¶æ˜¾ç¤º
        self.load_excel_file(file_path)
```

### 2. æ‰¹æ¬¡ä¿å­˜

å¯ä»¥ä¿å­˜æ¯ä¸ªæ‰¹æ¬¡çš„æ•°æ®ï¼Œæ–¹ä¾¿åç»­æŸ¥çœ‹ï¼š

```python
# æ‰¹æ¬¡å†å²
self.batch_history = []

def start_new_batch(self, batch_id, device_id):
    # ä¿å­˜æ—§æ‰¹æ¬¡æ•°æ®
    if self.current_batch_id:
        batch_record = {
            'batch_id': self.current_batch_id,
            'device_id': self.current_batch_device_id,
            'count': self.current_batch_count,
            'images': [...]  # å›¾ç‰‡è·¯å¾„åˆ—è¡¨
        }
        self.batch_history.append(batch_record)
    
    # å¼€å§‹æ–°æ‰¹æ¬¡
    # ...
```

### 3. æ‰¹æ¬¡åˆ‡æ¢

æ·»åŠ æ‰¹æ¬¡åˆ‡æ¢åŠŸèƒ½ï¼ŒæŸ¥çœ‹å†å²æ‰¹æ¬¡ï¼š

```python
# æ·»åŠ æ‰¹æ¬¡é€‰æ‹©å™¨
self.batch_combo = QComboBox()
self.batch_combo.addItems([f"æ‰¹æ¬¡ {i+1}" for i in range(len(self.batch_history))])
self.batch_combo.currentIndexChanged.connect(self.on_batch_selected)
```

---

âœ… æ‰€æœ‰åŠŸèƒ½å·²å®ç°ï¼

